<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browser</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .browser-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: #f5f5f5;
    }

    /* Tab Bar */
    .tab-bar {
      display: flex;
      align-items: flex-end;
      padding: 8px 8px 0;
      background: #e8e8e8;
      gap: 0;
      min-height: 42px;
    }


    .tabs-container {
      display: flex;
      align-items: flex-end;
      flex: 1;
      overflow-x: auto;
      gap: 0;
    }

    .tab {
      position: relative;
      display: flex;
      align-items: center;
      padding: 8px 12px;
      min-width: 180px;
      max-width: 240px;
      height: 34px;
      background: #d4d4d4;
      cursor: pointer;
      user-select: none;
      border-radius: 8px 8px 0 0;
      margin-right: -8px;
      z-index: 1;
    }

    .tab.active {
      background: #fff;
      z-index: 10;
    }

    .tab::before,
    .tab::after {
      content: '';
      position: absolute;
      bottom: 0;
      width: 16px;
      height: 16px;
      background: transparent;
    }

    .tab.active::before {
      left: -16px;
      background: radial-gradient(circle at 0 0, transparent 16px, #fff 16px);
      -webkit-mask-image: radial-gradient(circle at 0 0, transparent 16px, black 16px);
      mask-image: radial-gradient(circle at 0 0, transparent 16px, black 16px);
    }

    .tab.active::after {
      right: -16px;
      background: radial-gradient(circle at 100% 0, transparent 16px, #fff 16px);
      -webkit-mask-image: radial-gradient(circle at 100% 0, transparent 16px, black 16px);
      mask-image: radial-gradient(circle at 100% 0, transparent 16px, black 16px);
    }

    .tab-favicon {
      width: 16px;
      height: 16px;
      margin-right: 8px;
      flex-shrink: 0;
    }

    .tab-favicon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .tab-favicon .default-icon {
      width: 16px;
      height: 16px;
      background: #999;
      border-radius: 2px;
    }

    .tab-title {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 13px;
      color: #333;
    }

    .tab-close {
      width: 18px;
      height: 18px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-left: 8px;
      flex-shrink: 0;
    }

    .tab-close:hover {
      background: rgba(0,0,0,0.1);
    }

    .tab-close svg {
      width: 12px;
      height: 12px;
    }

    .new-tab-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
      margin-bottom: 4px;
      border-radius: 50%;
    }

    .new-tab-btn:hover {
      background: rgba(0,0,0,0.1);
    }

    .new-tab-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Navigation Bar */
    .nav-bar {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: #fff;
      gap: 8px;
      border-bottom: 1px solid #e0e0e0;
    }

    .nav-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .nav-btn:hover {
      background: #f0f0f0;
    }

    .nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .nav-btn svg {
      width: 20px;
      height: 20px;
    }

    .address-bar {
      flex: 1;
      display: flex;
      align-items: center;
      background: #f5f5f5;
      border-radius: 20px;
      padding: 6px 12px;
      gap: 8px;
    }

    .address-bar svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
      color: #666;
    }

    .address-input {
      flex: 1;
      border: none;
      background: transparent;
      outline: none;
      font-size: 14px;
    }

    /* Removed menu-btn styles */

    /* Content Area */
    .content-area {
      flex: 1;
      background: #fff;
      position: relative;
      overflow: hidden;
    }

    .tab-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .tab-content iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 16px;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      font-size: 13px;
      color: #333;
    }

    .battery {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .battery-icon {
      width: 24px;
      height: 12px;
      border: 1.5px solid #333;
      border-radius: 2px;
      position: relative;
      display: flex;
      align-items: center;
      padding: 2px;
    }

    .battery-icon::after {
      content: '';
      position: absolute;
      right: -4px;
      width: 2px;
      height: 6px;
      background: #333;
      border-radius: 0 1px 1px 0;
    }

    .battery-level {
      height: 100%;
      background: #333;
      border-radius: 1px;
      transition: width 0.3s;
    }

    .time-date {
      display: flex;
      gap: 16px;
    }
  </style>
</head>
<body>
  <div class="browser-container">
    <!-- Tab Bar -->
    <div class="tab-bar">
      <!-- Removed dropdown button -->
      <div class="tabs-container" id="tabsContainer"></div>
      <button class="new-tab-btn" id="newTabBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
    </div>

    <!-- Navigation Bar -->
    <div class="nav-bar">
      <button class="nav-btn" id="backBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
      </button>
      <button class="nav-btn" id="refreshBtn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
        </svg>
      </button>
      <div class="address-bar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" class="address-input" id="addressInput" placeholder="Search or enter URL">
      </div>
      <!-- Removed 3-dots menu button -->
    </div>

    <!-- Content Area -->
    <div class="content-area" id="contentArea"></div>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="battery">
        <div class="battery-icon">
          <div class="battery-level" id="batteryLevel" style="width: 100%"></div>
        </div>
        <span id="batteryPercent">100%</span>
      </div>
      <div class="time-date">
        <span id="currentTime"></span>
        <span id="currentDate"></span>
        <span id="currentYear"></span>
      </div>
    </div>
  </div>

  <script>
    let tabs = [];
    let activeTabId = null;
    let tabIdCounter = 0;

    const tabsContainer = document.getElementById('tabsContainer');
    const contentArea = document.getElementById('contentArea');
    const addressInput = document.getElementById('addressInput');
    const newTabBtn = document.getElementById('newTabBtn');
    const backBtn = document.getElementById('backBtn');
    const refreshBtn = document.getElementById('refreshBtn');

    function setupIframeListener(tabId, iframeEl) {
      try {
        const doc = iframeEl.contentDocument || iframeEl.contentWindow?.document;
        if (!doc) return;

        // Update title from iframe
        const observer = new MutationObserver(() => {
          const title = doc.title || 'New Tab';
          const tab = tabs.find(t => t.id === tabId);
          if (tab) {
            tab.title = title;
            if (tabId === activeTabId) {
              renderTabs();
            }
          }
        });

        observer.observe(doc.head || doc, { childList: true, subtree: true });

        // Get favicon from iframe
        const getFavicon = () => {
          const link = doc.querySelector("link[rel='icon']") || doc.querySelector("link[rel='shortcut icon']");
          const tab = tabs.find(t => t.id === tabId);
          if (tab && link?.href) {
            tab.favicon = link.href;
            if (tabId === activeTabId) {
              renderTabs();
            }
          }
        };

        // Try to get favicon immediately and after load
        iframeEl.addEventListener('load', getFavicon);
        getFavicon();
      } catch (e) {
        console.log('[v0] Could not setup iframe listener (cross-origin)');
      }
    }

    function createTab(url = null) {
      const tabId = ++tabIdCounter;
      const tab = {
        id: tabId,
        title: 'New Tab',
        url: url || '',
        favicon: null,
        isNewTab: !url
      };
      tabs.push(tab);
      renderTabs();
      renderContent();
      setActiveTab(tabId);
      
      if (url) {
        navigateTab(tabId, url);
      }
      
      return tabId;
    }

    function closeTab(tabId, e) {
      if (e) e.stopPropagation();
      
      const tabIndex = tabs.findIndex(t => t.id === tabId);
      if (tabIndex === -1) return;
      
      tabs.splice(tabIndex, 1);
      
      if (tabs.length === 0) {
        createTab();
      } else if (activeTabId === tabId) {
        const newActiveIndex = Math.min(tabIndex, tabs.length - 1);
        setActiveTab(tabs[newActiveIndex].id);
      }
      
      renderTabs();
      renderContent();
    }

    function setActiveTab(tabId) {
      activeTabId = tabId;
      renderTabs();
      
      const tab = tabs.find(t => t.id === tabId);
      if (tab) {
        addressInput.value = tab.url || '';
      }
      
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      const activeContent = document.getElementById(`content-${tabId}`);
      if (activeContent) {
        activeContent.classList.add('active');
      }
    }

    function renderTabs() {
      tabsContainer.innerHTML = '';
      
      tabs.forEach(tab => {
        const tabEl = document.createElement('div');
        tabEl.className = `tab ${tab.id === activeTabId ? 'active' : ''}`;
        tabEl.onclick = () => setActiveTab(tab.id);
        
        const faviconSrc = tab.isNewTab ? 'favicon2.png' : tab.favicon;
        
        tabEl.innerHTML = `
          <div class="tab-favicon">
            ${faviconSrc 
              ? `<img src="${faviconSrc}" onerror="this.parentElement.innerHTML='<div class=\\'default-icon\\'></div>'">`
              : '<div class="default-icon"></div>'
            }
          </div>
          <span class="tab-title">${tab.title}</span>
          <button class="tab-close" onclick="closeTab(${tab.id}, event)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        `;
        
        tabsContainer.appendChild(tabEl);
      });
    }

    function renderContent() {
      const existingIds = Array.from(contentArea.children).map(el => el.id);
      
      tabs.forEach(tab => {
        if (!document.getElementById(`content-${tab.id}`)) {
          const contentEl = document.createElement('div');
          contentEl.id = `content-${tab.id}`;
          contentEl.className = `tab-content ${tab.id === activeTabId ? 'active' : ''}`;
          
          if (tab.isNewTab) {
            contentEl.innerHTML = `<iframe src="newtab.html" id="iframe-${tab.id}"></iframe>`;
            setTimeout(() => {
              const iframeEl = document.getElementById(`iframe-${tab.id}`);
              if (iframeEl) setupIframeListener(tab.id, iframeEl);
            }, 100);
          }
          
          contentArea.appendChild(contentEl);
        }
      });
      
      existingIds.forEach(id => {
        const tabId = parseInt(id.replace('content-', ''));
        if (!tabs.find(t => t.id === tabId)) {
          document.getElementById(id)?.remove();
        }
      });
    }

    function buildUrl(input) {
      input = input.trim();
      
      // Check if it's already a full URL with protocol
      if (input.startsWith('http://') || input.startsWith('https://')) {
        return `active/embed.html?url=${input}`;
      }
      
      // Check if it looks like a domain (contains dot and no spaces)
      const domainRegex = /^[a-zA-Z0-9][a-zA-Z0-9-]*(\.[a-zA-Z0-9-]+)+/;
      if (domainRegex.test(input) && !input.includes(' ')) {
        return `active/embed.html?url=https://${input}`;
      }
      
      // Treat as search query
      const encodedQuery = encodeURIComponent(input);
      return `active/embed.html?url=https://www.google.com/search?q=${encodedQuery}`;
    }

    function navigateTab(tabId, url) {
      const tab = tabs.find(t => t.id === tabId);
      if (!tab) return;
      
      const fullUrl = buildUrl(url);
      tab.url = url;
      tab.isNewTab = false;
      
      const contentEl = document.getElementById(`content-${tabId}`);
      if (contentEl) {
        contentEl.innerHTML = `<iframe src="${fullUrl}" id="iframe-${tabId}"></iframe>`;
        
        // Update tab info
        tab.title = url;
        
        // Try to get favicon
        try {
          let domain;
          if (url.startsWith('http://') || url.startsWith('https://')) {
            domain = new URL(url).hostname;
          } else if (url.includes('.') && !url.includes(' ')) {
            domain = url.split('/')[0];
          } else {
            domain = 'www.google.com';
          }
          tab.favicon = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
        } catch (e) {
          tab.favicon = null;
        }
        
        setTimeout(() => {
          const iframeEl = document.getElementById(`iframe-${tabId}`);
          if (iframeEl) setupIframeListener(tabId, iframeEl);
        }, 100);
        
        renderTabs();
      }
      
      if (tabId === activeTabId) {
        addressInput.value = url;
      }
    }

    function navigate() {
      const url = addressInput.value.trim();
      if (!url) return;
      
      if (activeTabId) {
        navigateTab(activeTabId, url);
      }
    }

    window.addEventListener('message', (event) => {
      if (event.data.type === 'navigate' && event.data.url) {
        if (activeTabId) {
          const tab = tabs.find(t => t.id === activeTabId);
          if (tab) {
            const contentEl = document.getElementById(`content-${activeTabId}`);
            if (contentEl) {
              contentEl.innerHTML = `<iframe src="${event.data.url}" id="iframe-${activeTabId}"></iframe>`;
              
              // Extract the URL from the embed URL
              const urlMatch = event.data.url.match(/url=(.+)/);
              if (urlMatch) {
                const decodedUrl = decodeURIComponent(urlMatch[1]);
                tab.url = decodedUrl;
                tab.isNewTab = false;
                addressInput.value = decodedUrl;
                
                // Update title and favicon
                tab.title = decodedUrl;
                try {
                  const domain = new URL(decodedUrl).hostname;
                  tab.favicon = `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
                } catch (e) {
                  tab.favicon = null;
                }
                
                renderTabs();
                
                setTimeout(() => {
                  const iframeEl = document.getElementById(`iframe-${activeTabId}`);
                  if (iframeEl) setupIframeListener(activeTabId, iframeEl);
                }, 100);
              }
            }
          }
        }
      }
    });

    // Event Listeners
    newTabBtn.addEventListener('click', () => createTab());
    
    addressInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        navigate();
      }
    });

    backBtn.addEventListener('click', () => {
      const iframe = document.querySelector(`#iframe-${activeTabId}`);
      if (iframe) {
        try {
          iframe.contentWindow.history.back();
        } catch (e) {
          console.log('Cannot go back');
        }
      }
    });

    refreshBtn.addEventListener('click', () => {
      const iframe = document.querySelector(`#iframe-${activeTabId}`);
      if (iframe) {
        iframe.src = iframe.src;
      }
    });

    // Update time
    function updateTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes().toString().padStart(2, '0');
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      
      document.getElementById('currentTime').textContent = `${displayHours}:${minutes} ${ampm}`;
      
      const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
      document.getElementById('currentDate').textContent = `${months[now.getMonth()]} ${now.getDate()}`;
      document.getElementById('currentYear').textContent = now.getFullYear();
    }

    function updateBattery(battery) {
      const level = Math.round(battery.level * 100);
      document.getElementById('batteryLevel').style.width = level + '%';
      document.getElementById('batteryPercent').textContent = level + '%';
    }

    async function initBattery() {
      if ('getBattery' in navigator) {
        try {
          const battery = await navigator.getBattery();
          updateBattery(battery);
          
          battery.addEventListener('levelchange', () => updateBattery(battery));
          battery.addEventListener('chargingchange', () => updateBattery(battery));
        } catch (e) {
          console.log('Battery API not available');
        }
      }
    }

    updateTime();
    setInterval(updateTime, 1000);
    initBattery();

    // Initialize with one tab
    createTab();
  </script>
</body>
</html>
